{% extends "site_base.html" %}
{% load bootstrap_tags %}
{% load crispy_forms_field %}
{% load i18n %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load project_tags %}
{% load endless %}


{% block head_title %}
镜像备份
{% endblock %}
{% block extra_style %}
   
{% endblock %}
{% block breadcrumb %}
<li class="active">镜像备份</li>
{% endblock %}

{% block extra_breadcrumb %}
<form class="navbar-form navbar-right search_defined">
    <div class="form-group">
      <input placeholder="搜索" type="text" value="{{ query }}" name="query" value="" class="form-control search-query">
     <a href="javascript:;"><i class="glyphicon glyphicon-search"></i></a>
    </div>
</form>
{% endblock %}

{% block body %}
<div class="user_manage_tab"> 
    <a class="slice_index col-md-6 jx" href="{% url list_images 0%}">
        <span>镜像</span>
    </a>
    <a class="slice_index col-md-6 bf on" href="{% url list_snapshot%}">
         <span>备份</span>
    </a>
    <div class="clear"></div>
</div>

<div class="well intro_well">
    <h3 class="list_title">备份（Snapshots）</h3>                        
    <p class="list_lead">备份 (Snapshot) 用于对正在运行的主机做在线备份。</p>                     
</div>

<div class="action_box clearfix">
    <div class="pull-right">
        <!--button class="btn btn-inverse"><i class="glyphicon glyphicon-refresh"></i> 刷新</button-->
    </div>
</div>

<table class="table_defined row_chose"  id="snapshot_table">
    <thead>
        <tr>
            <th width="25%">ID</th>
            <th width="15%">名称</th>
            <th width="15%">描述</th>
            <th width="15%">主机</th>            
            <th width="15%">创建时间</th>
            <th width="10%">状态</th>
            {%if extent_html == "site_base.html"%}
            <th width="15%" class="t_dropdown">
                <span class="dropdown"> 
                    操作
                    <a id="" role="button" data-toggle="dropdown" href="#"><b class="caret"></b></a>
                        <ul class="dropdown-menu oper_menu" role="menu">
                            <li><a href="javascript:void(0);" id="create_image" data-toggle="" data-target="" class="disabled"><i class="glyphicon glyphicon-record"></i>制作镜像</a></li>
                            <li><a href="javascript:void(0);" id="edit_snapshot" data-toggle="" data-target="" class="disabled"><i class="glyphicon glyphicon-pencil"></i>编辑</a></li>
                            <li><a href="javascript:delete_from_dropdown();" class="disabled"><i class="glyphicon glyphicon-trash"></i>删除</a></li>
                                </ul>
                </span>
            </th>
            {%else%}
            <th width="15%">操作</th>
            {%endif%}
        </tr>
    </thead>
    <tbody>
        {% paginate 10 snapshots %}
        {%for snapshot in snapshots%}
        <tr class="tr">
            <td>{{snapshot.uuid}}</td>
            <td>{{snapshot.name}}</td>
            <td>{{snapshot.desc}}</td>
            <td>{{snapshot.vm.name}}</td>
            <td>{{snapshot.create_time|date:"Y-m-d H:i"}}</td>
            <td class="{{snapshot.uuid}} {{snapshot.vm.id}} pot_state">{%if snapshot.is_current%} <span title="使用中"></span>{%endif%}</td>
            <td class="btn_operation">
                {%if extent_html == "site_base.html"%}
                <a id="do_restore_{{snapshot.uuid}}" href="javascript:restore_snapshot('{{snapshot.vm.id}}', '{{snapshot.uuid}}');"><img src="{% static "img/btn_hy.png" %}" title="还原" /></a>
                {%else%}
                <a href="javascript:delete_snapshot('{{snapshot.uuid}}');"><img src="{% static "img/btn_sc.png" %}" title="删除" /></a>
                {%endif%}
            </td>             
        </tr>
        {%endfor%}
    </tbody>
</table>

<div class="text-center">
    <ul class="pagination">
        {% show_pages %}
    </ul>
</div>

<!-- 制作镜像 -->
<div id="make_image" class="modal fade modal_base_defined" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 id="myModalLabel" class="modal-title">制作镜像</h4>      
            </div>
            <div class="modal-body base_info form-horizontal">
                <div class="alert alert-info">
                    <strong>提示：</strong>初始用户名与密码必须是镜像中存在的用户名与密码，建议填写管理员的用户名与密码！
                </div>
                <div class="form-group name">
                    <label class="control-label col-md-3">名称</label>
                    <div class="col-md-8">
                            <input type="text" class="form-control" id="image_name" name="" />
                    </div>
                </div>
                <div class="form-group desc">
                    <label class="control-label col-md-3">描述</label>
                    <div class="col-md-8">
                            <textarea class="form-control" rows="3" id="image_desc"></textarea>
                    </div>
                </div>
                <div class="form-group username">
                    <label class="control-label col-md-3">初始用户名</label>
                    <div class="col-md-8">
                            <input type="text" class="form-control" id="image_username" name="" />
                    </div>
                </div>
                <div class="form-group passwd">
                    <label class="control-label col-md-3">初始密码</label>
                    <div class="col-md-8">
                            <input type="password" class="form-control" id="image_passwd" name="" />
                    </div>
                </div>
                <div class="form-group">
                   <label class="radio-inline radio_defined">
                      <input type="radio" name="inlineRadioOptions" id="image_public" value="1" checked> 共享
                    </label>
                    <label class="radio-inline">
                      <input type="radio" name="inlineRadioOptions" id="image_private" value="0"> 私有
                    </label>
                </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-default" data-dismiss="modal">取消</button>
              <button class="btn btn_info submit-create">确定</button>
            </div>
        </div>
    </div>
</div> 

<!-- 编辑 -->
<div id="snapshot_bj" class="modal fade modal_base_defined" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 id="myModalLabel" class="modal-title">编辑</h4>      
            </div>
            <div class="modal-body base_info form-horizontal">
                <div class="form-group name">
                    <label class="control-label col-md-2">名称</label>
                    <div class="col-md-8">
                            <input type="text" class="form-control" id="snapshot_name" />
                    </div>
                </div>
                <div class="form-group desc">
                    <label class="control-label col-md-2">描述</label>
                    <div class="col-md-8">
                            <textarea class="form-control" id="snapshot_desc" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-default" data-dismiss="modal">取消</button>
              <button class="btn btn_info submit-edit">确定</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_script %}
<script src="{{ STATIC_URL}}js/block_tab.js"></script>
<script src="{{ STATIC_URL}}js/snapshot.js"></script>
<script src="{{ STATIC_URL}}js/table_click.js"></script>
{% endblock %}
