{% extends "site_base.html" %}
{% load bootstrap_tags %}
{% load crispy_forms_field %}
{% load i18n %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load project_tags %}

{% block head_title %}
项目{% if form.instance.id%}编辑{% else %}创建{% endif %}
{% endblock %}
{% block extra_style %}
    <style type="text/css" media="screen">
        #div_id_islands {
            display:none;
        }
    </style>    
{% endblock %}
{% block breadcrumb %}
<li><a href="/project/">项目</a></li>
<li class="active">{% if form.instance.id %}{% trans "Edit Project" %}{% else %}{% trans "Create Project" %}{% endif %}</li>
{% endblock %}
{% block body %}
<div class="fill_form">
<form class="" action="" method="post" accept-charset="utf-8">
    {% csrf_token %}

        <h4 class="title_word_bg block_title">
            <img src="{% static "img/ic_baseinfo.png" %}" />基本信息
        </h4>

    <div class="row">
        <div class="col-md-5">
            {{ form.name|as_crispy_field }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-7">
            {{ form.description|as_crispy_field }}
        </div>
    </div>
    <div class="row">
        <div class="col-md-5">
            {{ form.category|as_crispy_field }}
        </div>
    </div>
  <div class="row">
      <div class="col-md-12">
    <legend>
        <div class="title_word_bg">
            添加资源 
            <div class="triangle"></div> 
        </div>       
    </legend>
        {% get_all_cities %}
        {% get_total_resources %}
        <div class="progress edit" style="width:150px;margin-bottom:10px;">
             <div class="bar bar-success" style="width: 50%;">交换机</div>
             <div class="bar bar-warning" style="width: 50%;">服务器</div>
        </div>
        {% if form.islands.errors %}
        <div class="form-group error">
                {% for error in form.islands.errors %}
                    <span class="help-inline">{{ error }}</span>
                {% endfor %}
        </div>
        {% endif %}

        <table class="table table-striped table-hover" cellspacing="1">
            <thead>
                <tr>
                    <th width="10%" class="checkall"><input type="checkbox"></th>
                    <th width="25%">城市名称</th>
                    <th width="25%">城市节点</th>
                    <th width="40%">节点资源</th>
                </tr>
            </thead>
            <tbody class="checkboxs">
                {% for city in cities %}
                    {% for island in city.island_set.all %}
                        {% resource_num island "switch" %}
                        {% resource_num island "server" %}
                        {% resource_num island "controller" %}
                        {% if switch_num|add:server_num|add:controller_num %}
                        <tr>
                            <td><input type="checkbox" {% if island|project_selected:form.instance %}{% if island.id in slice_islands %} class="sliced" {% endif %}checked{% endif %} name="islands" value="{{ island.id }}"></td>
                            <td>{{ city }}</td>
                            <td>{{ island }}</td>
                            <td>
                                <div class="progress">
                                    <div class="bar bar-success" style="width: {% resource_ratio switch_num total_resource%}%;">{{ switch_num }}</div>
                                    <div class="bar bar-warning" style="width: {% resource_ratio server_num total_resource%}%;">{{ server_num }}</div>
                                </div>
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
				  <div class="row">
                    <div class="col-md-3"><button type="submit" class="btn btn-lg btn-block btn-info">{% if form.instance.id %}保 存{% else %}创 建{% endif %}</button></div>
				  </div>
        </div>
      </div>
</form>
</div>
{% endblock %}

{% block extra_script %}
<script src="{{ STATIC_URL}}js/own.js"></script>
<script type="text/javascript" charset="utf-8">
    var has_slice = {% if has_slice %} true {% else %} false{% endif %};
    $('input[type="checkbox"]').on('ifUnchecked', function(event){
        if($(event.currentTarget).hasClass('sliced')) {
            alert("已经有Slice创建，如果希望更换节点请先删除该节点上的Slice");
            $(event.currentTarget).iCheck('check');
            throw Error();
        }
    });
    if($('.checkboxs input[type="checkbox"][checked]').length == $('.checkboxs input[type="checkbox"]').length) {
        $('.checkall input').iCheck('check');
        
    }
</script>
{% endblock %}
