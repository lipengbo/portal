{% extends "site_base.html" %}
{% load i18n %}
{% load url from future %}
{% load staticfiles %}

{% block head_title %}{% trans "create project" %}{% endblock %}
{% block breadcrumb %}
	<!--<a href="/project/create/">创建项目</a><span class="divider">/</span>-->
	<a href="/project/detail/{{ slice_obj.project.id }}/">项目详情</a><span class="divider">/</span>
	<!--<a href="/slice/create/{{ slice_obj.project.id }}/">创建Slice</a><span class="divider">/</span>-->
	Slice详情
{% endblock %}

{% block body %}
		<div class="fill_form form-wizard">
			  <fieldset class="base_info">
			    <legend>
			       {% if slice_obj.state == 0 %}
                        <a data-toggle="modal" href="#editInfoModal" class="btn btn-info edit">编辑</a>
                    {%else%}    
                        <a data-toggle="modal" href="#" class="btn btn-info edit" disabled>编辑</a>
                    {%endif%}
                    {% if slice_obj.state == 0 %}
                        <button type="button" class="btn btn-success start_btn edit start_slice" onclick="document.location='/slice/start_or_stop/{{ slice_obj.id }}/1/'">
                            启动Slice
                        </button>
                    {%else%}
                        <button type="button" class="btn btn-danger start_btn edit start_slice" onclick="document.location='/slice/start_or_stop/{{ slice_obj.id }}/2/'">
                            停止Slice
                        </button>
                    {%endif%}
			                         基本信息		   	
			    </legend>
			    <table class="table">
			    	<tbody>
			    		<tr>
			    			<td width="50">名称：</td>
			    			<td>{{slice_obj.name}}</td>
			    		</tr>
			    		<tr>
			    			<td width="50">状态：</td>
			    			<td>
			    				{%if slice_obj.state == 0%}
			    				<span class="label label-important">停止</span>
			    				{%else%}
			    				<span class="label label-success">启动</span>
			    				{%endif%}
			    			</td>
			    		</tr>
			    		<tr>
			    			<td class="v_top">描述：</td>
			    			<td>{{slice_obj.description}}</td>
			    		</tr>
			    		<tr>
			    			<td valign="top">节点：</td>
			    			<td>{{island.name}}</td>
			    		</tr>
			    	</tbody>
			    </table>			     
			  </fieldset>
			  <fieldset class="base_info">
			  	 <legend>Slice资源</legend>
			  	 <table class="table">
				 	<tbody>
				 		{%if controller%}
					 		<tr>
					 			<td width="20%">控制器</td>
					 			<td width="25%">IP:PORT：{{controller.ip}}:{{controller.port}}</td>
					 			<td width="25%">
                                    {%if controller.name == 'user_define' %}
                                    类型：自定义
                                    {%else%}
                                    类型：{{controller.name}}
                                    {%endif%}
                                </td>
					 			<td width="5%">
					 			{% if slice_obj.state == 1 %}
					 			    {%if controller.host%}
                                        {% if controller.host.state == 8 %}
                                        	<div id="controller_st{{controller.host.id}}">
	                                        	<img src="{% static "img/loader.gif" %}" />
	                                        </div>
	                                    {% elif controller.host.state == 9 %}
	                                        <i class="icon-remove"></i>
	                                    {%else%}
	                                        <i class="icon-ok"></i>
	                                    {%endif%}  
                                    {%endif%}
                                {%endif%}
					 			</td>
					 			<td width="25%">			    
					 			    {% if slice_obj.state == 0 %}
                                        <a data-toggle="modal" href="#editSliceModal" class="btn btn-info edit">编辑</a>
                                        {%if controller.host%}
                                    		<button type="button" onclick="" class="btn edit" disabled>登录</button>
                                    		{% if controller.host.state == 1 %}
											    <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/{{ controller.host.id }}/destroy')" class="btn btn-danger stop_btn edit" disabled>停止</button>									        
											{%else%}
											    <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ controller.host.id }}/create')" class="btn btn-success start_btn edit" disabled>启动</button>
											{%endif%}
                                    	{%endif%}
                                    {%else%}    
                                        <a data-toggle="modal" href="#" class="btn btn-info edit" disabled>编辑</a>
						 				{%if controller.host%}
							 				{% if controller.host.state == 8 %}
							 					<div id="controller_fc{{controller.host.id}}">
							 				
								 					<input class="aa" type="checkbox" name="check_vm_ids" value="{{controller.host.id}}" checked style="display:none"/>
			                                        <button type="button" onclick="" class="btn edit" disabled>登录</button>
			                                        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ controller.host.id }}/create')" class="btn btn-success start_btn edit" disabled>启动</button>
		                                   		</div>
		                                    {% elif controller.host.state == 9 %}
		                                    	<button type="button" onclick="" class="btn edit" disabled>登录</button>
		                                        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ controller.host.id }}/create')" class="btn btn-success start_btn edit" disabled>启动</button>
							 				{% elif controller.host.state == 1 %}
							 					<button type="button" onclick="open_vnc('/plugins/vt/vm/vnc/{{ controller.host.id }}')" class="btn edit">登录</button>
											    <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/{{ controller.host.id }}/destroy')" class="btn btn-danger stop_btn edit">停止</button>									        
											{%else%}
											    <button type="button" onclick="" class="btn edit" disabled>登录</button>
											    <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ controller.host.id }}/create')" class="btn btn-success start_btn edit">启动</button>
											{%endif%}
						 				{%endif%}
					 				{%endif%}
					 			</td>
					 		</tr>
				 		{%endif%}

				 		{%for gw in gws%}
					 		<tr>
					 			<td>虚拟网关</td>
					 			<td>IP：{{gw.ip}}</td>
					 			<td></td>
					 			<td></td>
					 			<td>
					 			    {% if slice_obj.state == 0 %}
                                        <a data-toggle="modal" href="#" class="btn btn-info edit">编辑</a>
                                    {%else%}
                                        <a data-toggle="modal" href="#" class="btn btn-info edit" disabled>编辑</a>
                                    {%endif%}
						 			<button type="button" class="btn btn-info edit">登录</button>
						 			<button type="button" class="btn btn-success start_btn edit">启动</button>
					 			</td>
					 		</tr>
				 		{%endfor%}
				 		{%for dhcp in dhcps%}
					 		<tr>
					 			<td>DHCP服务器</td>
					 			<td>IP：{{dhcp.ip}}</td>
					 			<td></td>
					 			<td></td>
					 			<td>
					 			    {% if slice_obj.state == 0 %}
                                        <a data-toggle="modal" href="#" class="btn btn-info edit">编辑</a>
                                    {%else%}
                                        <a data-toggle="modal" href="#" class="btn btn-info edit" disabled>编辑</a>
                                    {%endif%}
						 			<button type="button" class="btn btn-info edit">登录</button>
						 			<button type="button" class="btn btn-success start_btn edit">启动</button>
					 			</td>
					 		</tr>
					 	{%endfor%}
				 	</tbody>
				 </table>
				 <table class="table">
				 	<tbody>
				 		{%for vm in vms%}
					 		{%if vm.type == 1 %}
						 		<tr>
						 			<td width="20%">{{vm.name}}</td>
						 			<td width="25%">IP：{{vm.ip}}</td>
						 			<td width="25%">所属网络节点：{{vm.server.ip}}</td>
						 			<td width="5%">
							 			{% if slice_obj.state == 1 %}
		                                    {% if vm.state == 8 %}
		                                    <div id="vm_st{{vm.id}}">
		                                        <img src="{% static "img/loader.gif" %}" />
		                                    </div>
		                                    {% elif vm.state == 9 %}
		                                        <i class="icon-remove"></i>
		                                    {%else%}
		                                        <i class="icon-ok"></i>
		                                    {%endif%}
		                                {%endif%}
                                	</td>
						 			<td width="25%">
						 				{% if slice_obj.state == 0 %}
						 					<button type="button" onclick="window.location.href='{% url 'delete_vm' vm.id 0 %}'" class="btn btn-inverse btn-delete edit" disabled>删除</button>
						 					<button type="button" onclick="" class="btn edit" disabled>登录</button>
						 					{%if vm.state == 1 %}
		                                        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ vm.id }}/destroy')" class="btn btn-danger stop_btn edit" disabled>停止</button>
		                				    {%else%}
		                				        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ vm.id }}/create')" class="btn btn-success start_btn edit" disabled>启动</button>
		                				    {%endif%}
						 				{%else%}
		            						<button type="button" onclick="window.location.href='{% url 'delete_vm' vm.id 0 %}'" class="btn btn-inverse btn-delete edit">删除</button>
		                                    {% if vm.state == 8 %}
		                                    <div id="vm_fc{{vm.id}}">
		                                   
		                                    	<input class="aa" type="checkbox" name="check_vm_ids" value="{{vm.id}}" checked style="display:none"/>
		                                        <button type="button" onclick="open_vnc('/plugins/vt/vm/vnc/{{ vm.id }}')" class="btn edit" disabled>登录</a>
		                                        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/{{ vm.id }}/destroy')" class="btn btn-success start_btn edit" disabled>启动</button>
		                                    </div>
		                                    {% elif vm.state == 9 %}
		                                        <button type="button" onclick="open_vnc('/plugins/vt/vm/vnc/{{ vm.id }}')" class="btn edit" disabled>登录</a>
		                                        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/{{ vm.id }}/destroy')" class="btn btn-success start_btn edit" disabled>启动</button>
		                                    {% elif vm.state == 1 %}
		                                        <button type="button" onclick="open_vnc('/plugins/vt/vm/vnc/{{ vm.id }}')" class="btn edit">登录</a>
		                                        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ vm.id }}/destroy')" class="btn btn-danger stop_btn edit">停止</button>
		                				    {%else%}
		                				        <button type="button" onclick="" class="btn edit" disabled>登录</button>
		                				        <button type="button" onclick="do_vm_action('/plugins/vt/do/vm/action/{{ vm.id }}/create')" class="btn btn-success start_btn edit">启动</button>
		                				    {%endif%}
		                				{%endif%}
						 			</td>
						 		</tr>
						 	{%endif%}
				 		{%endfor%}
				 		{% if vms %}   
				 		 <tr>
				 		     <td colspan="5"><a href="{% url 'vm_list' slice_obj.id %}" class="edit">更多&gt;&gt;</a></td>
				 		 </tr>                             
                        {%endif%}
				 	</tbody>
				 </table>
				 <div class="clear" style="display: none" >
				 	<p id="check_vm">{{check_vm_status}}</p>
				 </div>
			  </fieldset>
			  <fieldset>
			  	 <legend>Slice拓扑</legend>
					<div id="content" style="background-color:#FFFFFF; width:100%; height:300px">
					</div>
					<div class="clear" style="display: none" >
						<p id="slice_id">{{slice_obj.id}}</p>
						<p id="topology_type">1</p>
						<p id="STATIC_URL">{{STATIC_URL}}</p>
					</div>
			  </fieldset>
				<!--
			  <div class="form-actions">
    			  <div class="row-fluid">
    			  	<div class="span4"></div>
    			  	<div class="span4">					
    			  	{% if slice_obj.state == 0 %}
    			  		<button type="button" class="btn btn-large btn-block btn-success start_btn" onclick="document.location='/slice/start_or_stop/{{ slice_obj.id }}/1/'">
    			  			启动Slice
    			  		</button>
    			  	{%else%}
    			  		<button type="button" class="btn btn-large btn-block btn-danger start_btn" onclick="document.location='/slice/start_or_stop/{{ slice_obj.id }}/2/'">
    			  			停止Slice
    			  		</button>
    			  	{%endif%}					
    			  	</div>
    			  	<div class="span4"></div>
    			  </div>
			  </div>
				-->			 
		</div>
		<div id="editInfoModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>    
              <h3>Slice基本信息编辑</h3>      
            </div>
            <form class="" action="/slice/edit_description/{{ slice_obj.id }}/" method="post" accept-charset="utf-8" onsubmit="return check_slice_description('slice_description',1)">{% csrf_token %}
            	<div class="modal-body">
                  <table class="table">
                      <tbody>
                          <tr>
                              <td width="150" class="text_r">名称</td>
                              <td>{{slice_obj.name}}</td>
                          </tr>
                          <tr>
                              <td class="v_top text_r">描述</td>
                              <td>
                              		<textarea rows="3" name="slice_description" id="slice_description">{{slice_obj.description}}</textarea>
                              		<span id="slice_descriptionInfo" style="display:inline;float:none;"></span> 
                              </td>
                          </tr>
                      </tbody>
                  </table>
	            </div>
	            <div class="modal-footer">
	              <button class="btn" data-dismiss="modal">取消</button>
	              <button  class="btn btn-primary" type="submit">确定</button>
	            </div>
          </form>
         </div>
         <div id="editSliceModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>    
              <h3>SLICE控制器编辑</h3>      
            </div>
            <form class="" action="/slice/edit_controller/{{ slice_obj.id }}/" method="post" accept-charset="utf-8" onsubmit="return check_slice_controller('controller_type')">{% csrf_token %}
            	<div class="modal-body tooltip-demo">
                  <table class="table">
                    <tbody>
                        <tr>
                            <td width="130">
                                <label class="radio tab_radio1">
                                  <input type="radio" name="controller_type" id="optionsRadios1" value="default_create"
                                  {%if controller.name == "user_define" %}{%else%}checked{%endif%}>
                                  默认创建
                                </label>
                            </td>
                            <td width="85">控制器类型</td>
                            <td>
                                <select name="controller_sys" id="controller_sys">
                                  <option value="floodlight" {%if controller.name == "floodlight" %}selected = "selected"{%endif%}>floodlight</option>
                                  <option value="pox" {%if controller.name == "pox" %}selected = "selected"{%endif%}>pox</option>
                                  <option value="nox" {%if controller.name == "nox" %}selected = "selected"{%endif%}>nox</option>
                                </select>
                                <a href="javascript:void(0);" data-toggle="tooltip" data-placement="right" title="" data-original-title="此处默认创建floodlight控制器"><i class="icon-question-sign icon-align-left"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label class="radio tab_radio2">
                                  <input type="radio" name="controller_type" id="optionsRadios2" value="user_define"
                                  {%if controller.name == "user_define"%}checked{%endif%}>
                                  自定义
                                </label>
                            </td>
                            <td>控制器IP端口</td> 
                            <td>
                            {%if controller.name == "user_define"%}
                                <input type="text" name="controller_ip_port" id="controller_ip_port" value={{controller.ip}}:{{controller.port}} onblur="check_slice_controller('controller_type')">
                            {%else%}
                                <input type="text" name="controller_ip_port" id="controller_ip_port" disabled onblur="check_slice_controller('controller_type')">
                            {%endif%}
                            	<span id="controller_ip_portInfo" style="display:inline;float:none;"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
	          </div>
	          <div class="modal-footer">
	              <button class="btn btn-info" data-dismiss="modal">取消</button>
	              <button class="btn btn-info" type="submit">确定</button>
	          </div>
            </form>
         </div>
{% endblock %}
{% block extra_script %}
<script src="{{ STATIC_URL}}js/own.js"></script>
<script src="{{ STATIC_URL}}js/slice_topology.js"  charset="utf-8"></script>
<script src="{{ STATIC_URL}}js/slice_verify.js"></script>
<script src="{{ STATIC_URL}}js/check_vm_status.js"></script>
<script src="{{ STATIC_URL}}js/vm.js"></script>
<script>
	$(function(){
		$(".aa").iCheck("destroy");
	})
</script>
{% endblock %}
