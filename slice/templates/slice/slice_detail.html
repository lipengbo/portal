{% extends extent_html %}
{% load i18n %}
{% load url from future %}
{% load staticfiles %}

{% block head_title %}Slice详情{% endblock %}
<!--{% block extra_style %}
<style>
img {
    max-width:none;
}
</style>
{% endblock %}-->
{% block breadcrumb %}
    {%if extent_html == "site_base.html" %}
	   <a href="/project/detail/{{ slice_obj.project.id }}/">项目详情</a><span class="divider">/</span>
	{%else%}
	   <a href="/project/">项目</a><span class="divider">/</span>
       <a href="/project/detail/{{ slice_obj.project.id }}/">项目详情</a><span class="divider">/</span>
    {%endif%}
	Slice详情
{% endblock %}

{% block body %}
<!--警告框 
<div id="alert_modal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-body">
      <p class="text-center" id="alert_msg"></p>
    </div>
    <div class="modal-footer">
      <button class="btn delete-confirm btn-info" data-dismiss="modal"id="alert_close">确定</button>
    </div>           
 </div>-->

    <div class="fill_form form-wizard">		    
        <fieldset class="base_info">
            <legend>
			    {%if extent_html == "site_base.html" %}
                    {% if slice_obj.state == 0 %}
                        <a data-toggle="modal" href="#editInfoModal" class="btn btn-info edit btn-slice-state">编辑</a>
                        <button type="button" class="btn btn-success start_btn edit start_slice">
                            启动Slice
                        </button>
                    {%else%}    
                        <a data-toggle="modal" href="#editInfoModal" class="btn btn-info edit disabled btn-slice-state" >编辑</a>
                        <button type="button" class="btn btn-danger start_btn edit start_slice">
                            停止Slice
                        </button>
                    {%endif%}
                {%endif%}			           
			    {{slice_obj.get_show_name}}
			    {%if slice_obj.state == 0%}
                    <span class="label label-important edit"><i class="icon-minus-sign icon-2x"></i></span>
                {%else%}
                    <span class="label label-success edit"><i class="icon-ok-sign icon-2x"></i></span>
                {%endif%}  		   	
            </legend>		
            <p class="muted" id="slice_description_old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{slice_obj.description}}</p>	  			  	     
        </fieldset>
        <fieldset>
            <div class="row-fluid">
                <div class="span1">
                </div>
<!--
                <div class="span8">

                    <!--<iframe scrolling="no" id="topologyiframe" width="620" height="300" src="/slice/topology_d3/?slice_id=0&width=620&height=300&top=0&switch_port_ids=1,2,3" frameborder="0"></iframe>-->

                    <iframe scrolling="no" id="topologyiframe" width="620" height="300" src="/slice/topology_d3/?slice_id={{slice_obj.id}}&width=620&height=300&top=1" frameborder="0"></iframe>

-->
                <div class="span10">
                    <iframe scrolling="no" id="topologyiframe" width="100%" height="300" src="/slice/topology_d3/?slice_id={{slice_obj.id}}&width=620&height=300&top=1" frameborder="0"></iframe>
                </div>
                <div class="span1">
                </div>
            </div>                  
           <div class="clear" style="display: none" >
                <p id="slice_id">{{slice_obj.id}}</p>
                <!-- <p id="topology_type">1</p>-->
                <p id="STATIC_URL">{{STATIC_URL}}</p>
            </div>
        </fieldset>
		<fieldset>
		<div id="alert_msg"></div>
            <legend>
                {%if extent_html == "site_base.html" and slice_obj.state == 0 %}
                    <a data-toggle="modal" href="/plugins/vt/create/vm/{{ slice_obj.id }}/0/" class="btn btn-info edit btn-slice-state">添加虚拟机</a>
                {%else%}
                    <a data-toggle="modal" href="/plugins/vt/create/vm/{{ slice_obj.id }}/0/" class="btn btn-info edit disabled btn-slice-state">添加虚拟机</a>
                {%endif%}

                Slice资源
            </legend>
		  	 <table class="table table-striped table-hover tooltip-demo">
		  	    <thead>
                    <tr>
                        {%if extent_html == "site_base.html" %}
                            <th width="10%">名称</th>
							<th width="15%">uuid</th>
                            <th width="15%">资源类型</th>
                            <th width="15%">IP地址</th>

                                <th width="15%">宿主机</th>
                                <th width="5%">状态</th>

                                <th width="25%">操作</th>
                        {%else%}
                            <th width="10%">名称</th>
							<th width="15%">uuid</th>
                            <th width="20%">资源类型</th>
                            <th width="15%">IP地址</th>

                                <th width="15%">宿主机</th>
                                <th width="5%">状态</th>

                                <th width="20%">操作</th>
                        {%endif%}
                    </tr>
                </thead>
			 	<tbody>
			 		{%if controller%}
				 		<tr>
				 			<td>
				 			    <div id="controller_nm">
                                {%if controller.name == 'user_define' %}
                                自定义控制器
                                {%else%}
                                {{controller.name}}
                                {%endif%}
                                </div>
                            </td>
							<td>
    							<div id="controller_uuid">
        							<a id="uuid" href="javascript:void(0);" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{controller.host.uuid}}">
        							{{controller.host.uuid}}
        							</a>
    							</div>
							</td>
                            <td>控制器</td>
                            <td>
                                <div id="controller_pp">
                                {{controller.ip}}:{{controller.port}}
                                </div>
                            </td>
                            <td>
                                <div id="controller_sp">
                                {%if controller.host%}
                                    {{controller.host.server.ip}}
                                {%endif%}
                                </div>
                            </td>

                               <td>
                                    <div id="controller_st">
                                        {%if controller.host%}
                                            {% if controller.host.state == 8 %}
                                                <img src="{% static "img/loader.gif" %}" />
                                            {% elif controller.host.state == 9 %}
                                                <i class="icon-remove"></i>
                                            {%elif controller.host.state == 1 %}
                                                <i class="icon-ok-sign icon_state" id="icon_state{{controller.host.id}}"></i>
                                            {%else%}
                                                <i class="icon-minus-sign icon_state" id="icon_state{{controller.host.id}}"></i>
                                            {%endif%}
                                        {%endif%}
                                    </div>
                               </td>

                            {%if extent_html == "site_base.html" %}
				 			   <td>
				 			        <span id="controller_fc">
                                        {%if controller.host%}
                                            {% if controller.host.state == 8 %}
                                                <input class="aa" type="checkbox" name="check_vm_ids" value="{{controller.host.id}}" checked style="display:none"/>
                                                <button type="button" class="btn btn-success disabled start_vm">启动</button>
                                                <button type="button" class="btn  btn_vnc disabled" id="btn_vnc{{controller.host.id}}">登录</button> 
                                            {% elif controller.host.state == 9 %}
                                                <button type="button" class="btn btn-success disabled start_vm">启动</button>
                                                <button type="button" class="btn btn_vnc disabled" id="btn_vnc{{controller.host.id}}">登录</button>
                                            {% elif controller.host.state == 1 %}
                                                <button type="button" vm_id="{{ controller.host.id }}" class="btn btn-danger start_vm">停止</button>                                          
                                                <button type="button" url="/plugins/vt/vm/vnc/{{ controller.host.id }}" class="btn btn_vnc" id="btn_vnc{{controller.host.id}}">登录</button>
                                            {%else%}
                                                <button type="button" vm_id="{{ controller.host.id }}" class="btn btn-success start_vm">启动</button>
                                                <button type="button" url="/plugins/vt/vm/vnc/{{ controller.host.id }}" class="btn btn_vnc disabled" id="btn_vnc{{controller.host.id}}">登录</button>
                                            {%endif%}
                                        {%endif%}
                                    </span>
                                    {% if slice_obj.state == 1 %}
                                        <a data-toggle="modal" href="#editSliceModal" class="btn btn-info disabled btn-slice-state" >编辑</a>
                                    {%else%}
                                        <a data-toggle="modal" href="#editSliceModal" class="btn btn-info btn-slice-state">编辑</a>
                                    {%endif%}
                               </td>
					 		{%else%}
					 		    <td>
    					 		    {%if controller.host%}
    					 		        {% if controller.host.state == 8 %}
                                        <span id="controller_fc">
                                            <input class="aa" type="checkbox" name="check_vm_ids" value="{{controller.host.id}}" checked style="display:none"/>
                                            <button type="button" onclick="" class="btn" disabled>监控</button>
                                        </span>
                                        {%elif controller.host.state == 9 %} 
                                            <button type="button" onclick="" class="btn" disabled>监控</button>  
                                        {%else%}
                                            <button type="button" onclick="document.location='/monitor/vm/{{ controller.host.id }}/'" class="btn">监控</button>
                                        {%endif%}
    					 		    {%endif%}
					 		    </td>
					 		{%endif%}
				 		</tr>
			 		{%endif%}

			 		{%if gw %}
				 		<tr>
				 		    <td>gateway</td>
							<td><a id="uuid" href="javascript:void(0);" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{gw.uuid}}">{{gw.uuid}}</a></td>
				 			<td>虚拟网关</td>
				 			<td>{{gw.ip}}</td>
				 			<td>{{gw.server.ip}}</td>
                                <td>
                                    {% if gw.state == 8 %}
                                    <div id="gw_st{{gw.id}}">
                                        <img src="{% static "img/loader.gif" %}" />
                                    </div>
                                    {% elif gw.state == 9 %}
                                        <i class="icon-remove"></i>
                                    {%elif gw.state == 1 %}
                                        <i class="icon-ok-sign gw_dhcp_icon"></i>
                                    {%else%}
                                        <i class="icon-minus-sign gw_dhcp_icon"></i>
                                    {%endif%}  
                                </td>
				 			{%if extent_html == "site_base.html" %}
                               <td>
                                    {% if gw.state == 8 %}
                                        <span id="gw_fc{{gw.id}}">
                                            <input class="aa" type="checkbox" name="check_vm_ids" value="{{gw.id}}" checked style="display:none"/>
                                            <button type="button" class="btn btn-success start_gw_dhcp disabled">启动</button>
                                            <button type="button" class="btn btn_vnc disabled gw_dhcp_vnc">登录</button> 
                                        </span>
                                    {% elif gw.state == 9 %}
                                        <button type="button" class="btn btn-success start_gw_dhcp disabled">启动</button>
                                        <button type="button" class="btn btn_vnc disabled gw_dhcp_vnc">登录</button>
                                    {% elif gw.state == 1 %}
                                        <button type="button" vm_id="{{ gw.id }}" class="btn btn-danger start_gw_dhcp">停止</button>                                          
                                        <button type="button" url="/plugins/vt/vm/vnc/{{ gw.id }}" class="btn btn_vnc gw_dhcp_vnc">登录</button>
                                    {%else%}
                                        <button type="button" vm_id="{{ gw.id }}" class="btn btn-success start_gw_dhcp">启动</button>
                                        <button type="button" url="/plugins/vt/vm/vnc/{{ gw.id }}" class="btn btn_vnc gw_dhcp_vnc disabled">登录</button>
                                    {%endif%}
                               </td>  
                            {%else%}
                                <td>
                                    {% if gw.state == 8 %}
                                    <span id="gw_fc{{gw.id}}">
                                        <input class="aa" type="checkbox" name="check_vm_ids" value="{{gw.id}}" checked style="display:none"/>
                                        <button type="button" onclick="" class="btn" disabled>监控</button>
                                    </span>
                                    {%elif gw.state == 9 %} 
                                        <button type="button" onclick="" class="btn" disabled>监控</button>  
                                    {%else%}
                                        <button type="button" onclick="document.location='/monitor/vm/{{ gw.id }}/'" class="btn">监控</button>
                                    {%endif%}
                                </td>
                            {%endif%}
				 		</tr>
			 		{%endif%}
			 		{%if dhcp%}
				 		<tr>
				 		    <td>dhcp</td>
							<td><a id="uuid" href="javascript:void(0);" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{dhcp.uuid}}">{{dhcp.uuid}}</a></td>
				 			<td>DHCP服务器</td>
				 			<td>{{dhcp.ip}}</td>
				 			<td>{{dhcp.server.ip}}</td>
                                <td>
                                    {% if dhcp.state == 8 %}
                                    <div id="dhcp_st{{dhcp.id}}">
                                        <img src="{% static "img/loader.gif" %}" />
                                    </div>
                                    {% elif dhcp.state == 9 %}
                                        <i class="icon-remove"></i>
                                    {%elif dhcp.state == 1 %}
                                        <i class="icon-ok-sign gw_dhcp_icon"></i>
                                    {%else%}
                                        <i class="icon-minus-sign gw_dhcp_icon"></i>
                                    {%endif%} 
                                </td>
				 			{%if extent_html == "site_base.html" %}
                               <td>
                                    {% if dhcp.state == 8 %}
                                        <span id="dhcp_fc{{dhcp.id}}">
                                            <button type="button" class="btn btn-success start_gw_dhcp disabled">启动</button>
                                            <button type="button" class="btn btn_vnc disabled gw_dhcp_vnc">登录</button> 
                                        </span>
                                    {% elif dhcp.state == 9 %}
                                        <button type="button" class="btn btn-success start_gw_dhcp disabled">启动</button>
                                        <button type="button" class="btn btn_vnc disabled gw_dhcp_vnc">登录</button>
                                    {% elif dhcp.state == 1 %}
                                        <button type="button" vm_id="{{ dhcp.id }}" class="btn btn-danger start_gw_dhcp">停止</button>                                          
                                        <button type="button" url="/plugins/vt/vm/vnc/{{ dhcp.id }}" class="btn btn_vnc gw_dhcp_vnc">登录</button>
                                    {%else%}
                                        <button type="button" vm_id="{{ dhcp.id }}" class="btn btn-success start_gw_dhcp">启动</button>
                                        <button type="button" url="/plugins/vt/vm/vnc/{{ dhcp.id }}" class="btn btn_vnc disabled gw_dhcp_vnc">登录</button>
                                    {%endif%}
                               </td>
                            {%else%}
                                <td>
                                    {% if dhcp.state == 8 %}
                                    <span id="dhcp_fc{{dhcp.id}}">
                                        <input class="aa" type="checkbox" name="check_vm_ids" value="{{dhcp.id}}" checked style="display:none"/>
                                        <button type="button" onclick="" class="btn" disabled>监控</button>
                                    </span>
                                    {%elif dhcp.state == 9 %} 
                                        <button type="button" onclick="" class="btn" disabled>监控</button>  
                                    {%else%}
                                        <button type="button" onclick="document.location='/monitor/vm/{{ dhcp.id }}/'" class="btn">监控</button>
                                    {%endif%}
                                </td>
                            {%endif%}
				 		</tr>
				 	{%endif%}

			 		{%for vm in vms%}
				 		<tr id="vm_tr{{vm.id}}">
				 			<td>{{vm.name}}</td>
							<td><a id="uuid" href="javascript:void(0);" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{vm.uuid}}">{{vm.uuid}}</a></td>
				 			<td>虚拟机</td>
				 			<td>{{vm.ip}}</td>
				 			<td>{{vm.server.ip}}</td>
                                <td>
                                    {% if vm.state == 8 %}
                                    <div id="vm_st{{vm.id}}">
                                        <img src="{% static "img/loader.gif" %}" />
                                    </div>
                                    {% elif vm.state == 9 %}
                                        <i class="icon-remove"></i>
                                    {%elif vm.state == 1 %}
                                        <i class="icon-ok-sign icon_state" id="icon_state{{vm.id}}"></i>
                                    {%else%}
                                        <i class="icon-minus-sign icon_state" id="icon_state{{vm.id}}"></i>
                                    {%endif%}  
                                </td>
				 			{%if extent_html == "site_base.html" %}

                            	<td>
                                    {% if vm.state == 8 %}
                                    <span id="vm_fc{{vm.id}}">
                                        <input class="aa" type="checkbox" name="check_vm_ids" value="{{vm.id}}" checked style="display:none"/>
                                        <button type="button" class="btn btn-success disabled start_vm">启动</button>
                                        <button type="button" class="btn  btn_vnc disabled" id="btn_vnc{{vm.id}}">登录</button>
                                    </span>
                                    {% elif vm.state == 9 %}
                                        <button type="button" class="btn btn-success disabled start_vm">启动</button>
                                        <button type="button" class="btn  btn_vnc disabled" id="btn_vnc{{vm.id}}">登录</button>
                                    {% elif vm.state == 1 %}
                                        <button type="button" vm_id="{{ vm.id }}" class="btn btn-danger start_vm">停止</button>
                                        <button type="button" url="/plugins/vt/vm/vnc/{{ vm.id }}" class="btn btn_vnc" id="btn_vnc{{vm.id}}">登录</button>
                                    {%else%}
                                        <button type="button" vm_id="{{ vm.id }}" class="btn btn-success start_vm">启动</button>
                                        <button type="button" url="/plugins/vt/vm/vnc/{{ vm.id }}" class="btn btn_vnc disabled" id="btn_vnc{{vm.id}}">登录</button>
                                    {%endif%}
                				{% if slice_obj.state == 1 %}
                				    <a href="{% url 'delete_vm' vm.id 0 %}" vm_id="{{vm.id}}" class="btn btn-inverse disabled slice_state_del">删除</a>
                				{%else%}
                				    <a href="{% url 'delete_vm' vm.id 0 %}" vm_id="{{vm.id}}" class="btn btn-inverse slice_state_del">删除</a>
				 			    {%endif%}
				 			    </td>
					 		   
					 		{%else%}
					 		   <td>
					 		        {% if vm.state == 8 %}
                                    <span id="vm_fc{{vm.id}}">
                                        <input class="aa" type="checkbox" name="check_vm_ids" value="{{vm.id}}" checked style="display:none"/>
                                        <button type="button" onclick="" class="btn" disabled>监控</button>
                                    </span>
                                    {%elif vm.state == 9 %} 
                                        <button type="button" onclick="" class="btn" disabled>监控</button>  
                                    {%else%}
                                        <button type="button" onclick="document.location='/monitor/vm/{{ vm.id }}/'" class="btn">监控</button>
                                    {%endif%}
                                    {% if slice_obj.state == 1 %}
                                        <a href="{% url 'delete_vm' vm.id 0 %}" vm_id="{{vm.id}}" class="btn btn-inverse disabled slice_state_del">删除</a>
                                    {%else%}
                                        <a href="{% url 'delete_vm' vm.id 0 %}" vm_id="{{vm.id}}" class="btn btn-inverse slice_state_del">删除</a>
                                    {%endif%}
                               </td>
                            {%endif%}
					 	</tr>
			 		{%endfor%}
			 	</tbody>
			 </table>
		    {% if vms %}
                <a class="edit view_more" href="{% url 'vm_list' slice_obj.id %}">More&nbsp;<i class="icon-play"></i></a>                                            
            {%endif%}
			 <div class="clear" style="display: none" >
			 	<!--<p id="check_vm">{{check_vm_status}}</p>-->
			 	{%if extent_html == "site_base.html" %}
			 	<p id="admin">0</p>
			 	{%else%}
			 	<p id="admin">1</p>
			 	{%endif%}
			 </div>
		  </fieldset>			  		 
		</div>
		<div id="editInfoModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>    
              <h3>Slice基本信息编辑</h3>      
            </div>
            <form class="" accept-charset="utf-8">{% csrf_token %}
            	<div class="modal-body base_info">
                  <table class="table">
                      <tbody>
                          <tr>
                              <td width="150" class="text_r">名称</td>
                              <td>{{slice_obj.get_show_name}}</td>
                          </tr>
                          <tr>
                              <td class="v_top text_r">描述</td>
                              <td>
                              		<textarea rows="3" maxlength=1024 name="slice_description" id="slice_description">{{slice_obj.description}}</textarea>
                              		<span id="slice_descriptionInfo" style="display:inline;float:none;"></span> 
                              </td>
                          </tr>
                      </tbody>
                  </table>
	            </div>
	            <div class="modal-footer">
	              <button class="btn btn-info" data-dismiss="modal">取消</button>
	              <button type="button" onclick="edit_description('{{ slice_obj.id }}')" class="btn btn-info">确定</button>
	            </div>
          </form>
         </div>
         <div id="editSliceModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>    
              <h3>SLICE控制器编辑</h3>      
            </div>
            <form class="" accept-charset="utf-8">{% csrf_token %}
            	<div class="modal-body base_info tooltip-demo">
                  <table class="table">
                    <tbody>
                        <tr>
                            <td width="130">
                                <label class="radio tab_radio1">
                                  <input type="radio" name="controller_type" id="optionsRadios1" value="default_create"
                                  {%if controller.name == "user_define" %}{%else%}checked{%endif%}>
                                  默认创建
                                </label>
                            </td>
                            <td width="95">控制器类型</td>
                            <td>
                                {%if controller.name == "user_define" %}
                                    <select name="controller_sys" id="controller_sys" disabled>
                                      <option value="floodlight">floodlight</option>
                                      <option value="pox">pox</option>
                                      <option value="nox">nox</option>
                                    </select>
                                {%else%}
                                    <select name="controller_sys" id="controller_sys">
                                      <option value="floodlight" {%if controller.name == "floodlight" %}selected = "selected"{%endif%}>floodlight</option>
                                      <option value="pox" {%if controller.name == "pox" %}selected = "selected"{%endif%}>pox</option>
                                      <option value="nox" {%if controller.name == "nox" %}selected = "selected"{%endif%}>nox</option>
                                    </select>
                                {%endif%}
                                <a href="javascript:void(0);" data-toggle="tooltip" data-placement="right" title="" data-original-title="此处默认创建floodlight控制器"><i class="icon-question-sign icon-align-left"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label class="radio tab_radio2">
                                  <input type="radio" name="controller_type" id="optionsRadios2" value="user_define"
                                  {%if controller.name == "user_define"%}checked{%endif%}>
                                  自定义
                                </label>
                            </td>
                            <td>控制器IP端口</td> 
                            <td>
                            {%if controller.name == "user_define"%}
                                <input type="text" name="controller_ip_port" id="controller_ip_port" value={{controller.ip}}:{{controller.port}} onblur="check_slice_controller('controller_type')">
                            {%else%}
                                <input type="text" name="controller_ip_port" id="controller_ip_port" disabled onblur="check_slice_controller('controller_type')">
                            {%endif%}
                            	<span id="controller_ip_portInfo" style="display:inline;float:none;"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
	          </div>
	          <div class="modal-footer">
	              <button class="btn btn-info" data-dismiss="modal">取消</button>
	              <button type="button" onclick="edit_controller('{{ slice_obj.id }}')" class="btn btn-info">确定</button>
	          </div>
            </form>
         </div>
<div id="slicealertModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-body" id="slice_alert_info">
      <p class="text-center">slice创建失败！</p>
    </div> 
    <div class="modal-footer">
      <button class="btn btn-info" data-dismiss="modal" id="alert_closed">确定</button>
    </div>          
</div>
{% endblock %}
{% block extra_script %}
<script src="{{ STATIC_URL}}js/own.js"></script>
<!--<script src="{{ STATIC_URL}}js/slice_topology.js"  charset="utf-8"></script>-->
<script src="{{ STATIC_URL}}js/slice_verify.js"></script>
<script src="{{ STATIC_URL}}js/check_vm_status_slice.js"></script>
<script src="{{ STATIC_URL}}js/vm.js"></script>
<script>
	$(function(){
		$(".aa").iCheck("destroy");
		show_uuid($("[id='uuid']"));
	})
</script>
{% endblock %}
