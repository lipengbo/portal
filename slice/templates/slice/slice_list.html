{% extends extent_html %}

{% load i18n %}
{% load url from future %}
{% load staticfiles %}
{% load project_tags %}

{% block head_title %}SLICE列表{% endblock %}
{% block breadcrumb %}
    {%if extent_html == "site_base.html" %}
        <a href="/project/detail/{{ project.id }}/">项目详情</a><span class="divider">/</span>  
        Slice列表
    {%else%}
        {%if project%}
        <a href="/project/">项目</a><span class="divider">/</span>
        <a href="/project/detail/{{ project.id }}/">项目详情</a><span class="divider">/</span>
        {%endif%}
        虚网
    {%endif%}
{% endblock %}

{% block body %}

    <div class="search">
        <form class="form-search">
          <div class="input-append">
              <input type="text" value="{{ query }}" name="query" value="" class="span2 search-query">
              <button type="submit" class="btn">搜索</button>
          </div>
        </form>
    </div>
    <div class="fill_form">
        <fieldset>
             
                {%if extent_html == "site_base.html" %}

                    <div class="well">
                    <h3 class="list_title">我的Slice</h3>
                    <p class="list_lead">虚网是CCF中用于提供研究人员进行实验的最小独立容器，虚网由实验所需要的计算和网络资源组成。</p>
                    </div> 
                {%else%}
                    {%if project%}
                        <div class="well">
                        <h3 class="list_title">我的Slice</h3>
                        <p class="list_lead">虚网是CCF中用于提供研究人员进行实验的最小独立容器，虚网由实验所需要的计算和网络资源组成。</p>
                        </div> 
                    {%else%}
                    <legend>虚网（Slice）</legend>
                    <div class="row-fluid countschart">
                        <div class="span2 counts">
                            <div class="counts_block">
                                <p><img src="{% static "img/file-01.png" %}"  /></p>
                                <p class="counts_block_title">新增虚网</p>

                                <p class="counts_block_nums">{{new_num}}</p>
                            </div>
                            <div class="counts_block">
                                <p><img src="{% static "img/file-02.png" %}"  /></p>
                                <p class="counts_block_title">全部虚网</p>

                                <p class="counts_block_nums">{{total_num}}</p>
                            </div>                                                 
                        </div>                        
                        <div class="span10">
                            <div id="container" style="min-width: 400px; height: 212px; margin: 0 auto"></div>
                        </div>
                        <div class="clear"></div>      
                    </div>

                    {%endif%}
                {%endif%}
                <div class="clear" style="display: none" >
                    {%if extent_html == "site_base.html"%}
                        <p id="slice_show">0</p>
                    {%else%}
                        {%if project %}
                            <p id="slice_show">0</p>
                        {%else%}
                            <p id="slice_show">1</p>
                        {%endif%}
                    {%endif%}
                </div>
             {% if not slices %}
                {%if query %}
                <p class="alert alert-info">抱歉，没有找到任何相关的结果</p>
                {%else%}
                <p class="alert alert-info">当前没有SLICE</p>
                {%endif%}
             {% endif %}
             <div class="row-fluid">
             {%if slices %}
             <div id="slice_list_show">
                 {% load endless %}
                 {% paginate 4 slices %}
                 {% for group in slices|group_by:2 %}
                 <ul class="thumbnails example-sites">
    		         {% for slice in group %}
    		              {% include "slice/_slice.html" %}
    		         {% endfor %}
    		     </ul>
    		     {% endfor %}
    		     <div class="pagination">
                    <ul>
                        {% show_pages %}
                    </ul>
                </div>
		     </div>
		     {%endif%}
		     </div>
         </fieldset>
    </div>
{% endblock %}
{% block extra_script %}
<script src="{{ STATIC_URL}}js/jquery.knob.js"></script>
<script src="{{ STATIC_URL}}js/slice_list.js"></script>
<script src="{{ STATIC_URL}}js/own.js"></script>
<script src="{{ STATIC_URL}}js/slice_pagination.js"></script>
<script type="text/javascript">
$(function () {
        slice_show = $("#slice_show").text();
        if(slice_show == '1'){
            check_url = "/slice/get_slice_show/";
            //alert(check_url)
            var show_dates = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30];
            var show_nums = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
            $.ajax({
                type: "GET",
                url: check_url,
                dataType: "json",
                cache: false,
                async: false,  
                success: function(data) {
                    if (data.result == 1)
                     {
                       // alert("in true")
                        //show_dates = data.show_dates;
                        show_nums = data.show_nums;
                     } 
                     else
                     {
                        //show_dates = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30];
                        //show_nums = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
                     }
                }
            });
            console.log(show_dates);
            console.log(show_nums);
            $('#container').highcharts({
                chart: {
                    type: 'column',
                    margin: [ 50, 50, 20, 50]
                },
                title: {
                    text: '每日新增虚网数'
                },
                xAxis: {
                    categories: show_dates,
                    labels: {
                        rotation: 0,
                        align: 'right',
                        style: {
                            fontSize: '13px',
                            fontFamily: 'Verdana, sans-serif'
                        }
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: '虚网数(个)'
                    }
                },
                legend: {
                    enabled: false
                },
                //tooltip: {
                 //   formatter: function() {
                       // return '<b>'+ this.x +'</b><br/>'+
                  //          '创建的虚网个数: '+ Highcharts.numberFormat(this.y, 1) +
                   //         ' 个';
                   // }
               // },
                series: [{
                    name: 'Slice',
                    data: show_nums,
                    dataLabels: {
                        enabled: true,
                        rotation: -90,
                        color: '#FFFFFF',
                        align: 'right',
                        x: 4,
                        y: 10,
                        style: {
                            fontSize: '13px',
                            fontFamily: 'Verdana, sans-serif'
                        }
                    }
                }]
            });
         }
    });
    

        </script>
<script src="{{ STATIC_URL}}js/highcharts/highcharts.js"></script>
<script src="{{ STATIC_URL}}js/highcharts/modules/exporting.js"></script>
{% endblock %}
