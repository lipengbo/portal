{% load i18n %}
{% load staticfiles %}
<body style="margin: 0">
<div id="container" style="min-width: 400px; height: 182px; margin: 0 auto"></div>
<div class="clear" style="display: none" >
    <p id="target">{{target}}</p>
    <p id="type">{{type}}</p>
    <p id="stype">{{stype}}</p>
</div>
</body>
<script src="{{ STATIC_URL}}topology/lib/jquery.min.js"></script>
<script src="{{ STATIC_URL}}js/highcharts/highcharts.js"></script>
<script src="{{ STATIC_URL}}js/highcharts/modules/exporting.js"></script>
<script type="text/javascript">
    $(function () {
        //alert("in");
        var target = $("#target").text();
        var type = $("#type").text();
        var stype = $("#stype").text();
        var total_num = 0;
        var show_dates = [];
        var show_nums = [];
        var title = "";
        var name = "";
        var coler = ['#2f7ed8', '#0d233a', '#8bbc21'];
        var check_url = "/slice/get_count_show/?target="+target+"&type="+type+"&total_num="+total_num+"&stype="+stype;
        $.ajax({
            type: "GET",
            url: check_url,
            dataType: "json",
            cache: false,
            async: false,  
            success: function(data) {
                if (data.result == 1)
                 {
                    show_dates = data.show_dates;
                    show_nums = data.show_nums;
                 } 
                 else
                 {
                    //show_dates = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30];
                    //show_nums = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
                 }
            }
        });
        if(target == "project"){
            name = "项目";
        }else{
            name = "虚网";
        }
        var date=new Date;
        var year=date.getFullYear().toString();
        var month=(date.getMonth()+1).toString();
        var titshow = '<small>{point.key}</small><br>'
        if(type == "year"){
            total_num = 5;
            coler = ['#8bbc21', '#0d233a', '#2f7ed8'];
            if(target == "project"){
                title = show_dates[0]+"-"+show_dates[9]+"每年新增项目数";
            }else{
                title = show_dates[0]+"-"+show_dates[9]+"每年新增虚网数";
            }
        }else if(type == "month"){
            total_num = 12;
            coler = ['#0d233a', '#8bbc21', '#2f7ed8'];
            if(target == "project"){
                title = year + "年每月新增项目数";
            }else{
                title = year + "年每月新增虚网数";
            }
        }else{
            titshow = '<small>{point.key}日</small><br>'
            total_num = 15;
            coler = ['#2f7ed8', '#0d233a', '#8bbc21'];
            if(target == "project"){
                title = year + "年" + month + "月每日新增项目数";
            }else{
                title = year + "年" + month + "月每日新增虚网数";
            }
        }
        $('#container').highcharts({
            chart: {
                type: 'column',
                margin: [ 40, 30, 20, 40]
            },
            colors: coler,
            title: {
                text: title
            },
            exporting: {
                enabled: false
            },
            xAxis: {
                categories: show_dates,
                labels: {
                    rotation: 0,
                    align: 'center',
                    style: {
                        fontSize: '11px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: name + '数(个)'
                }
            },
            tooltip: {
                shared: true,
                useHTML: true,
                headerFormat: titshow,
            //    pointFormat: '<tr><td style="color: {series.color}">{series.name}: </td>' +
            //    '<td style="text-align: right"><b>{point.y}个</b></td></tr>',
            //    footerFormat: '</table>',
            //    valueDecimals: 2
            },
            legend: {
                enabled: false
            },
            //tooltip: {
            //    formatter: function() {
            //        return '<b>'+ this.x +'</b><br/>'+
            //            'Population in 2008: '+ Highcharts.numberFormat(this.y, 1) +
             //           ' millions';
            //    }
           // },
            series: [{
                name: name,
                data: show_nums,
                dataLabels: {
                    enabled: true,
                    rotation: -90,
                    color: '#FFFFFF',
                    align: 'right',
                    x: 4,
                    y: 10,
                    style: {
                        fontSize: '13px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            }]
        });
        
    });
    </script>