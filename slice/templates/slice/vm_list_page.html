{% load staticfiles %}
{% load endless %}
{% paginate 4 vms %}
<h4 class="block_title">
    <img src="{{ STATIC_URL}}img/ic_lb.png" />虚拟机列表<span>【可用IP：{%if slice_obj.vm_num == 0 %}无{%elif slice_obj.vm_num == 1 %}{{vm_start_ip}}{%else%}{{ vm_start_ip }}-{{ vm_end_ip }}{%endif%}】
    <div class="pull-right">
         {%if extent_html == "site_base.html" and permission == "edit" and slice_type == "mixslice" %}
                <a class="bianji" id="vm_add" href="javascript:void(0);" onclick="can_create_vm({{slice_obj.id}});"
                 {% if slice_obj.state == 0 %}style="cursor:pointer"{%else%}style="cursor:not-allowed"{%endif%} title="创建虚拟机">
                <i class="icon-plus"></i>
                </a>
         {%endif%}                              
    </div>
</h4>
<div class="alert alert-info">
    <strong>提示：</strong>使用更多操作时，请用鼠标点击选中下面某个具体的虚拟机
</div>
<table class="table_defined tooltip-demo row_chose"  id="vm_table">
  <thead>
    <tr>
      <th width="17%">名称</th>
      <th width="15%">UUID</th>
      <!--th width="15%">DHCP</th-->
      <th width="15%">IP地址</th>
      <th width="15%">宿主机</th>
      <th width="10%">备份点</th>
      <th width="8%">状态</th>
      <th width="15%" class="t_dropdown">
        <span class="dropdown"> 
          更多操作
          <a id="" role="button" data-toggle="dropdown" href="#"><b class="caret"></b></a>
          <ul id="" class="dropdown-menu oper_menu" role="menu">
              <li><a href="javascript:snapshot_creation_show();" data-toggle="" data-target="" class="disabled"><i class="icon-camera"></i>创建备份</a></li>
              <li><a href="javascript:void(0);" id="create_image_from_vm" data-toggle="" data-target="" class="disabled"><i class="glyphicon glyphicon-record"></i>创建镜像</a></li>              
              <li><a href="javascript:void(0);" id="edit_vm" data-toggle="" data-target="" class="disabled"><i class="icon-cogs"></i>参数配置</a></li>
           </ul>
        </span>
      </th>
    </tr>
  </thead>
  <tbody>
    {% for vm in vms %}
    <tr class="tr">
      <td><div {%if vm.type_id == 1%}class="user_define"{%endif%}
      {%if vm.type_id == 2%}class="default_create"{%endif%}
      {%if vm.type_id == 3%}class="gw"{%endif%}
      {%if vm.type_id == 4%}class="vm"{%endif%} vm_id="{{vm.id}}">
        {{vm.name}}</div></td>
      <td><div>
        <a id="uuid" class="uuid" href="javascript:void(0);" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{vm.uuid}}">
        {{vm.uuid}}
        </a></div></td>
      <!--td>{{vm.dhcp}}</td-->
      <td><div>
        {{vm.ip}}
        </div></td>
      <td><div id="vm_host_ip" host_ip="{{vm.host_ip}}">
        {{vm.host_ip}}
        </div></td>
        <td><div>{%if vm.current_snapshot != None%}{{vm.current_snapshot}}{%else%}无{%endif%}</div></td>
      <td class="slice_state"><div>
        {% if vm.state != "" %}
            {% if vm.state == 8 or vm.state == 12 or vm.state == 13 or vm.state == 3%}
                <i class="icon-spinner icon-spin check_vm" id="icon_state{{vm.id}}"></i>
            {% elif vm.state == 9 or vm.state == 10 %}
                <i class="icon-remove-sign" id="icon_state{{vm.id}}"></i>
            {% elif vm.state == 11 %}
                <i class="icon-warning-sign" id="icon_state{{vm.id}}" title="资源不足"></i>
            {% elif vm.state == 1 %}
                <i class="icon-ok-sign icon_state check_start_vm" id="icon_state{{vm.id}}"></i>
            {%elif vm.state == 5 or vm.state == 0%}
                <i class="icon-minus-sign icon_state" id="icon_state{{vm.id}}"></i>
            {%elif vm.state == 3%}
                <i class="icon-pause check_vm" id="icon_state{{vm.id}}"></i>
            {%endif%}
          {%endif%}
        </div></td>
        
        <td class="btn_operation"> 
            {%if extent_html == "site_base.html"%}
                {%if vm.type_id != 1%}
                {%if vm.state == 8 or vm.state == 9 or vm.state == 10 or vm.state == 11 or vm.state == 12 or vm.state == 13 %}
                        <a href="javascript:void(0);" id="{{vm.id}}_qt" onclick="start_stop_vm({{vm.id}}, {{vm.type_id}});" style="cursor: not-allowed;">
                            <img src="{{ STATIC_URL}}img/ic-ks-un.png" 
                            {%if vm.state == 12 %}title="启动中"{%else%}
                            {%if vm.state == 13 %}title="停止中"{%else%}title="启动"{%endif%}{%endif%} />
                        </a>
                    {%else%}
                        <a href="javascript:void(0);" id="{{vm.id}}_qt" onclick="start_stop_vm({{vm.id}}, {{vm.type_id}});" style="cursor: pointer;">
                        {%if vm.state == 1 %}
                            <img src="{{ STATIC_URL}}img/ic-tz.png" title="停止" />
                        {%elif vm.state == 5 or vm.state == 0 %}
                            <img src="{{ STATIC_URL}}img/ic-ks.png" title="启动" />
                        {%elif vm.state == 3%}
                            <img src="{{ STATIC_URL}}img/ic-tz-un.png" title="停止" />
                        {%endif%}
                        </a>
                    {%endif%}
                {%endif%}
            {%endif%} 
            <!--{%if extent_html == "admin_base.html"%}
                {%if vm.type_id != 1%}
                    {%if vm.state == 1 %}
                        <a href="javascript:void(0);" id="{{vm.id}}_jk" onclick="jk_vm({{vm.id}});" style="cursor:pointer">
                        <img src="{{ STATIC_URL}}img/btn_jk.png" title="监控" />
                        </a>
                    {%else%}
                        <a href="javascript:void(0);" id="{{vm.id}}_jk" onclick="jk_vm({{vm.id}});" style="cursor:not-allowed">
                        <img src="{{ STATIC_URL}}img/btn_jk_gray.png" title="监控" />
                        </a>
                    {%endif%}
                {%endif%}
            {%endif%}-->
            {%if extent_html == "site_base.html"%}
                {%if vm.type_id != 1%}
                    {%if vm.state == 1 %}
                        <a href="javascript:void(0);" id="{{vm.id}}_dl" onclick="dl_vm({{vm.id}}, {{island.id}});" style="cursor: pointer;">
                        <img src="{{ STATIC_URL}}img/btn_dl.png" title="登录" />
                        </a>
                    {%else%}
                        <a href="javascript:void(0);" id="{{vm.id}}_dl" onclick="dl_vm({{vm.id}}, {{island.id}});" style="cursor: not-allowed;">
                        <img src="{{ STATIC_URL}}img/btn_dl_gray.png" title="登录" />
                        </a>
                    {%endif%}
                {%endif%}
            {%endif%}
            {%if extent_html == "site_base.html" and permission == "edit" %}
                {%if vm.type_id == 1 or vm.type_id == 2 %}
                    {%if slice_obj.state == 0 %}
                        <a class="bianji" href="javascript:void(0);" id="{{vm.id}}_bj" onclick="return bj_vm({{vm.id}});" style="cursor: pointer;">
                        <img src="{{ STATIC_URL}}img/btn_bj.png" title="编辑" />
                        </a>
                    {%else%}
                        <a class="bianji" href="javascript:void(0);" id="{{vm.id}}_bj" onclick="return bj_vm({{vm.id}});" style="cursor: not-allowed;">
                        <img src="{{ STATIC_URL}}img/btn_bj_gray.png" title="编辑" />
                        </a>
                    {%endif%}
                {%endif%}
            {%endif%}
            {%if extent_html == "admin_base.html" or permission == "edit" %}
                {%if vm.type_id == 4%}
                    {%if slice_obj.state == 0 and vm.state != 3%}
                        <a class="shanchu" href="javascript:void(0);" id="{{vm.id}}_sc" onclick="sc_vm({{vm.id}});" style="cursor: pointer;">
                        <img src="{{ STATIC_URL}}img/btn_sc.png" title="删除" />
                        </a>
                    {%else%}
                        <a class="shanchu" href="javascript:void(0);" id="{{vm.id}}_sc" onclick="sc_vm({{vm.id}});" style="cursor: not-allowed;">
                        <img src="{{ STATIC_URL}}img/btn_sc_gray.png" title="删除" />
                        </a>
                    {%endif%}
                {%endif%}
            {%endif%}
      </td>
    </tr>
    {%endfor%}
  </tbody>
</table>

<div class="text-center">
    <ul class="pagination">
        {% show_pages %}
    </ul>
</div>
<!-- 制作镜像 -->
<div id="make_image" class="modal fade modal_base_defined" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 id="myModalLabel" class="modal-title">制作镜像</h4>      
            </div>
            <div class="modal-body base_info form-horizontal">
                <div class="alert alert-info">
                    <strong>提示：</strong>初始用户名与密码必须是镜像中存在的用户名与密码，建议填写管理员的用户名与密码！
                </div>
                <div class="form-group name">
                    <label class="control-label col-md-3">名称</label>
                    <div class="col-md-8">
                            <input type="text" class="form-control" id="image_name" name="" />
                    </div>
                </div>
                <div class="form-group desc">
                    <label class="control-label col-md-3">描述</label>
                    <div class="col-md-8">
                            <textarea class="form-control" rows="3" id="image_desc"></textarea>
                    </div>
                </div>
                <div class="form-group username">
                    <label class="control-label col-md-3">初始用户名</label>
                    <div class="col-md-8">
                            <input type="text" class="form-control" id="image_username" name="" />
                    </div>
                </div>
                <div class="form-group passwd">
                    <label class="control-label col-md-3">初始密码</label>
                    <div class="col-md-8">
                            <input type="password" class="form-control" id="image_passwd" name="" />
                    </div>
                </div>
                <div class="form-group">
                   <label class="radio-inline radio_defined col-md-2 col-md-offset-3">
                      <input type="radio" name="radioOptions" id="image_public" value="1" checked> 共享
                    </label>
                    <label class="radio-inline col-md-2">
                      <input type="radio" name="radioOptions" id="image_private" value="0"> 私有
                    </label>
                </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-default" data-dismiss="modal">取消</button>
              <button class="btn btn_info submit-create-fromvm">确定</button>
            </div>
        </div>
    </div>
</div> 
