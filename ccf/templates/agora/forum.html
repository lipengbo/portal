{% extends "forum_base.html" %}

{% load endless %}
{% load url from future %}

{% block head_title %}
{{ forum }}
{% endblock %}

{% block forum_body %}
{% include "agora/_forum_breadcrumb.html" with thread=thread %}

<div class="row">
    <div class="col-md-12">
        
        <div class="action_box clearfix">
                <div class="pull-right">
                   <a href="{% url "agora_post_create" forum.id %}" class="btn btn-default">
                       <i class="glyphicon glyphicon-plus"></i>
                                                                                新建工单
                   </a>
                </div>
                <form class="navbar-form pull-right navbar-right search_defined">
                    <div class="form-group">
                      <input placeholder="搜索" type="text" value="{{ query }}" name="query" value="" class="form-control search-query">
                     <a href="javascript:;"><i class="glyphicon glyphicon-search"></i></a>
                    </div>
                </form>
        </div>
        
        {% paginate 20 threads %}
        <table class="table_defined">
          <thead>
            <tr>
              <th>#工单号</th>
              <th>标题</th>
              <th>内容</th>
              {% if user.is_superuser %}
                <th>提交者</th>
              {% endif %}
              <th>创建时间</th>
              <th>状态</th>
            </tr>
          </thead>
          <tbody>
            {% for thread in threads %}
            <tr>
              <td>{{ thread.id }}</td>
              <td><a href="{% url "agora_thread" thread.id %}">{{ thread.title }}</a></td>
              <td>{{ thread.content }}</td>
              {% if user.is_superuser %}
              <td>{{ thread.author }}</td>
              {% endif %}
              <td>{{ thread.created|date:"Y-m-d H:s:i" }}</td>
              <td>{% if thread.closed %}已关闭{% else %}
                  {% if thread.last_post != thread %}
                  已回复
                  {% else %}
                  尚无回复
                  {% endif %}
                  {% endif %}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
    {% if not threads %}
        {% if query %}
            <p class="alert alert-info">抱歉，没有找到任何相关的结果</p>
        {% else %}
            <p class="alert alert-info">暂无记录</p>
        {% endif %}
    {% endif %}
        <ul class="pagination">
            {% show_pages %}
        </ul>
    </div>
</div>
{% endblock %}


