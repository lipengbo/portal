{% extends "site_base.html" %}
{% load bootstrap_tags %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load project_tags %}

{% block extra_style %}
    <style type="text/css" media="screen">
        #div_id_islands {
            display:none;
        }
    </style>    
{% endblock %}
{% block breadcrumb %}
<li class="active">{% if form.instance.id %}{% trans "Edit Project" %}{% else %}{% trans "Create Project" %}{% endif %}</li>
{% endblock %}
{% block body %}
<form class="" action="" method="post" accept-charset="utf-8">
    <legend>基本信息</legend>
    {% csrf_token %}
    {{ form|crispy  }}
    <legend>添加资源 </legend>
    <div id="div_id_islands_display" class="control-group  ">
        <label for="id_islands" class="control-label required-field">
                节点
        </label>
        {% get_all_cities %}
        {% get_total_resources %}
        <div class="progress" style="width:150px;">
             <div class="bar bar-success" style="width: 33%;">交换机</div>
             <div class="bar bar-warning" style="width: 33%;">服务器</div>
             <div class="bar bar-danger" style="width: 34%;">控制器</div>
        </div>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th width="25%">节点名称</th>
                    <th width="25%">详细节点</th>
                    <th width="50%">节点资源</th>
                </tr>
            </thead>
            <tbody>
                {% for city in cities %}
                    {% for island in city.island_set.all %}
                        {% resource_num island "switch" %}
                        {% resource_num island "server" %}
                        {% resource_num island "controller" %}
                        {% if switch_num|add:server_num|add:controller_num %}
                        <tr>
                            <td>{{ city }}</td>
                            <td><button type="button" class="btn node_btn" data-toggle="button" data-id="{{ island.id }}">{{ island }}</button></td>
                            <td>
                                <div class="progress">
                                    <div class="bar bar-success" style="width: {% resource_ratio switch_num total_resource%}%;">{{ switch_num }}</div>
                                    <div class="bar bar-warning" style="width: {% resource_ratio server_num total_resource%}%;">{{ server_num }}</div>
                                    <div class="bar bar-danger" style="width: {% resource_ratio controller_num total_resource%}%;">{{ controller_num }}</div>
                                </div>
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{% trans "Save" %}</button>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_script %}
    <script  type="text/javascript" charset="utf-8">
        $.each($('#id_islands option[selected]'), function(){
            $('.node_btn[data-id=' + $(this).attr('value') + ']').addClass("active");
        });
        $('.node_btn').click(function(){
            var option = $('#id_islands option[value=' + $(this).data('id') + ']');
            if($(this).hasClass("active")) {
                option.removeAttr('selected');
            } else {
                option.attr('selected', '');
            }
        })
    </script>

{% endblock %}
