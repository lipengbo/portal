{% extends "site_base.html" %}
{% load bootstrap_tags %}
{% load i18n %}
{% load staticfiles %}

{% block breadcrumb %}
	<a href="/project/create/">创建项目</a><span class="divider">/</span>
	<a href="/project/detail/{{ slice_obj.project.id }}/">项目详情</a><span class="divider">/</span>
	<a href="/slice/create/{{ slice_obj.project.id }}/">创建Slice</a><span class="divider">/</span>
	<a href="/slice/detail/{{ slice_obj.id }}/">Slice详情</a><span class="divider">/</span>
        <a href="{%url create_vm slice_obj.id%}">{% trans "create vm" %}</a><span class="divider">/</span>
        <li class="active">{% trans "Vm list" %}</li>
{% endblock %}

{% block body %}
<div class="fill_form form-wizard">
    <fieldset class="base_info">
        <legend>虚拟机
	    <a data-toggle="modal" href="{% url create_vm sliceid %}" class="btn btn-info edit">添 加</a>
            <a data-toggle="modal" href="{% url slice_detail sliceid %}" class="btn btn-info edit">返 回</a>
        </legend>
        <table class="table">
            <tbody>
            {% for vm in vms %}
                    <tr>
                        <td width="20%">{{ vm.name }}</td>
                        <td width="20%">IP: {{ vm.ip }}</td>
                        <td width="30%">所属网络节点: {{ vm.server.ip }}</td>
                        <td width="5%">
                            {%if controller.host%}
                                {% if vm.state == 8 %}
                                <img src="{% static "img/loader.gif" %}" />
                            {% elif vm.state == 9 %}
                                <i class="icon-remove"></i>
                            {%else%}
                                <i class="icon-ok"></i>
                            {%endif%}  
                            {%endif%}
                        </td>
			<td width="25%">
			    {% if vm.state == 8 %}
                    <button type="button" onclick="do_vm_action('{% url do_vm_action vm.id 'destroy' %}')" class="btn btn-success stop_btn" disabled>停止</button>
                    <button type="button" onclick="open_vnc('{% url vm_vnc vm.id %}')" class="btn" disabled>登录</a>
			    {% elif vm.state == 9 %}
                    <button type="button" onclick="do_vm_action('{% url do_vm_action vm.id 'destroy' %}')" class="btn btn-success stop_btn" disabled>停止</button>
                    <button type="button" onclick="open_vnc('{% url vm_vnc vm.id %}')" class="btn" disabled>登录</a>
			    {% elif vm.state == 1 %}
			        <button type="button" onclick="do_vm_action('{% url do_vm_action vm.id 'destroy' %}')" class="btn btn-success stop_btn">停止</button>
			        <button type="button" onclick="open_vnc('{% url vm_vnc vm.id %}')" class="btn">登录</a>
			    {%else%}
			        <button type="button" onclick="do_vm_action('{% url do_vm_action vm.id 'create' %}')" class="btn btn-success start_btn">启动</button>
			        <button type="button" onclick="" class="btn" disabled>登录</button>
			    {%endif%}
  			    <button type="button" onclick="window.location.href='{% url delete_vm vm.id 1 %}'" class="btn btn-delete">删除</button>
			</td>
                    </tr>
            {% endfor %}
            </tbody>
        </table>
    </fieldset>
</div>
{% endblock %}
{% block extra_script %}
<script src="{{ STATIC_URL}}js/vm.js"></script>
{% endblock %}
