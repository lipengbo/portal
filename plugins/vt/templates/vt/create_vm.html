{% extends "site_base.html" %}
{% load bootstrap_tags %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% block breadcrumb %}
	<a href="/project/detail/{{ slice_obj.project.id }}/">项目详情</a><span class="divider">/</span>
	<a href="/slice/detail/{{ slice_obj.id }}/">Slice详情</a><span class="divider">/</span>
        <li class="active">{% trans "create vm" %}</li>
{% endblock %}
{% block body %}
<!--警告框-->
<div id="slicealertModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-body" id="slice_alert_info">
      <p class="text-center"></p>
    </div> 
    <div class="modal-footer">
      <button class="btn delete-confirm btn-info" data-dismiss="modal" id="alert_close_sure">确定</button>
    </div>          
</div>

<!-- 拓扑图 -->
<div id="topologyModal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
	<div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">当前已选节点资源</h4>
    </div>
    <div class="modal-body" id="topology_info">
		<div class="row-fluid">
        	<div class="span8">
        		<iframe scrolling="no" id="topologyiframe" width="450" height="300" src="/slice/topology_d3/?slice_id={{slice_obj.id}}&width=450&height=300&top=0" frameborder="0"></iframe>
         	</div>
         </div>  
	</div>                
</div>

<form class="form-wizard" action="" method="post" accept-charset="utf-8">
    <fieldset class="vm_info_list tooltip-demo">
    <legend>虚拟机信息</legend>
    <div class="sec_block">
    {% csrf_token %}
  <div class="row-fluid vm_well_wrap"> 
    <div class="span5 base_info">       
    <table class="table">
        <tbody>
            <tr>
                <td width="30%">名称</td>
                <td>
                    <input id="id_name" onblur="check_vm_name('name')" type="text" name="name" maxlength="20" />
                    <span name="nameInfo"></span>                         
                </td>
            </tr>
            <tr>
                <td>虚拟机类型</td>
                <td>
                    {{ vm_form.flavor }} <span name="flavorInfo"></span>
                </td>
            </tr>
            <tr>
                <td>虚拟机镜像</td>
                <td>
                    {{ vm_form.image }} <span name="imageInfo"></span>
                </td>
            </tr>
            <tr>
                <td>宿主机</td>
                <td>
                    {{ vm_form.server }} <span name="serverInfo"></span>
                </td>
            </tr>
        </tbody>
    </table>
    {% if slice_obj.get_dhcp %}
        <label class="">
            {{ vm_form.enable_dhcp }} {{vm_form.enable_dhcp.errors}}
                                                    是否启动DHCP
        </label>
    {%endif%}
    <div class="operate_btn">
        <button class="btn btn-inverse del" type="button">删 除</button>
    </div> 
    </div>     
    
    <div class="span7">
       <div class="vm_well">
           <h4>虚拟机配置</h4>
           <table class="table table-bordered table-condensed">
               <tbody>
                   <tr>
                      <td width="80">类型</td>
                      <td colspan="5"><span name="flavor_msg"></span></td>
                   </tr>
                   <tr>
                       <td width="80"><img src="{% static "img/cpu.png" %}" width="20" />CPU</td>
                       <td><span name="cpu"></span>核</td>
                       <td width="80"><img src="{% static "img/nc.png" %}" width="20" />内存</td>
                       <td><span name="ram"></span>MB</td>
                       <td width="80"><img src="{% static "img/cp.png" %}" width="20" />磁盘</td>
                       <td><span name="hdd"></span>GB</td>
                   </tr>
                   <tr>
                      <td>宿主机</td>
                      <td colspan="5"><span name="server_msg"></span></td>
                   </tr>
                   <tr>
                      <td>镜像</td>
                      <td colspan="5"><span name="image_msg"></span></td>
                   </tr>
                   <tr>
                      <td>用户名</td>
                      <td colspan="5"><span name="username"><span></td>
                   </tr>
                   <tr>
                      <td>密码</td>
                      <td colspan="5"><span name="password"></span></td>
                   </tr>
               </tbody>
           </table>
       </div>
   </div>   
   </div>                
   </div>   
    </fieldset>
    <p class="add_btn">
		<button class="btn btn-info" type="button" id="show_topo">查看拓扑</button>
		<button class="btn btn-info add" type="button">继续添加</button>
	</p>
    <div class="form-actions">
        <div class="row-fluid">
            <div class="span3"></div>
          {% if from_link == '0' %}
          <div class="span3"><button type="button" class="btn btn-large btn-block btn-info" onclick="document.location='{% url slice_detail sliceid %}'">{% trans "Cancel" %}</button></div>
          {% else %}
          <div class="span3"><button type="button" class="btn btn-large btn-block btn-info" onclick="document.location='{% url vm_list sliceid %}'">{% trans "Cancel" %}</button></div>
          {% endif %}
          <div class="span3"><button type="button" class="btn btn-large btn-block btn-info" onclick="create_vms({{ sliceid }}, 1, {{from_link}})">{% trans "Submit" %}</button></div>
          <div class="span3"></div>
        </div>
    </div>
</form>
{% endblock %}
{% block extra_script %}
<script src="{{ STATIC_URL}}js/icheck/jquery.icheck.min.js"></script>
<script src="{{ STATIC_URL}}js/own.js"></script>
<script src="{{ STATIC_URL}}js/vm.js"></script>
<script>
	$("#alert_close_sure").on("click", function(){
		window.location.href='/plugins/vt/vm/list/' + {{sliceid}} + '/';
	})
	
</script>
{% endblock %}
